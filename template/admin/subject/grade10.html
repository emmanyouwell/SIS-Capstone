<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subject - Grade 10</title>
    <link rel="stylesheet" href="../css/admin-dashboard.css">
    <link rel="stylesheet" href="grade10.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo-container">
            <img src="../../images/logo.jpg" alt="School Logo">
        </div>
        <ul>
          <li>
            <a href="../admin-main.html">
              <span class="icon">
                <!-- Dashboard icon -->
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
              </span>
              Dashboard
            </a>
          </li>
            <li><a href="../admin-dashboard.html"><span class="icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span>Announcements</a></li>
            <li><a href="../admin-accounts.html"><span class="icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 8-4 8-4s8 0 8 4"/></svg></span>Accounts</a></li>
            <li><a href="../admin-grades.html"><span class="icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg></span>Grades</a></li>
            <li class="active"><a href="../admin-subject.html" aria-current="page"><span class="icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M2 19.5A2.5 2.5 0 0 1 4.5 17H20"/><path d="M2 6.5A2.5 2.5 0 0 1 4.5 4H20v16H4.5A2.5 2.5 0 0 1 2 17.5z"/></svg></span>Subject</a></li>
            <li><a href="../admin-schedule.html"><span class="icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></span>Schedule</a></li>
            <li><a href="../admin-enrollment.html"><span class="icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M2 7v13a2 2 0 0 0 2 2h14"/><path d="M22 7v13a2 2 0 0 1-2 2H6"/><path d="M2 7a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2"/><path d="M12 5v16"/></svg></span>Enrollment</a></li>
            <li><a href="../admin-masterlist.html"><span class="icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><circle cx="3" cy="6" r="1"/><circle cx="3" cy="12" r="1"/><circle cx="3" cy="18" r="1"/></svg></span>Masterlist</a></li>
            <li><a href="../admin-notification.html"><span class="icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg></span>Notifications</a></li>
            <li><a href="../admin-message.html"><span class="icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="14" rx="2"/><polyline points="3 7 12 13 21 7"/></svg></span>Messages</a></li>
            <li><a href="../admin-profile.html"><span class="icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7"/><path d="M9 22V12h6v10"/></svg></span>Profile</a></li>
        </ul>
    </div>
    <!-- Top Header -->
    <div class="top-header">
        <div class="school-name">Sto. Ni√±o National High School</div>
        <div class="header-controls">
            <div class="notifications">
                <img src="https://cdn-icons-png.flaticon.com/128/3602/3602145.png" alt="Notifications" class="icon">
                <span class="badge">3</span>
            </div>
            <div class="user-controls">
                <div class="user-info">
                    <div class="user-name">Erwin Acorda</div>
                    <div class="user-role">Administrator</div>
                </div>
                <div class="user-avatar">
                    <img src="https://cdn-icons-png.flaticon.com/128/3135/3135715.png" alt="User Avatar">
                </div>
                <button class="logout-btn btn-smart-animate"><span>Logout</span></button>
            </div>
        </div>
    </div>
    <!-- Main Content -->
    <div class="main-content">
      <div class="materials-title">Subject - Grade 10</div>
      <div class="materials-flex-row">
        <div class="section-list-card">
          <div class="section-list-title">Subjects</div>
          <ul class="section-list">
            <li>Mathematics</li>
            <li>Science</li>
            <li>English</li>
            <li>MAPEH</li>
            <li>Filipino</li>
            <li>Araling Panlipunan</li>
            <li>Values Education</li>
          </ul>
          <button class="edit-subjects-btn"><i class="material-icons">edit</i> Edit subjects</button>
        </div>
        <div style="flex: 1;">
          <div class="material-table-card">
            <table class="material-table" id="subject-table">
              <thead>
                <tr>
                  <th style="color: #184d27; background: none; font-weight: 700;">Subjects</th>
                  <th style="color: #184d27; background: none; font-weight: 700;">Subject Teachers</th>
                  <th style="color: #184d27; background: none; font-weight: 700;">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr data-subject="Mathematics" data-teachers='["Mr. William Harris","Ms. Victoria Clark","Mr. Nathan Lewis"]'>
                  <td>Mathematics</td>
                  <td class="teacher-cell"></td>
                  <td><button class="edit-icon-btn"><i class="material-icons">edit</i></button></td>
                </tr>
                <tr data-subject="Science" data-teachers='["Ms. Olivia Walker","Mr. Ethan Hall"]'>
                  <td>Science</td>
                  <td class="teacher-cell"></td>
                  <td><button class="edit-icon-btn"><i class="material-icons">edit</i></button></td>
                </tr>
                <tr data-subject="English" data-teachers='["Ms. Sophia Young"]'>
                  <td>English</td>
                  <td class="teacher-cell"></td>
                  <td><button class="edit-icon-btn"><i class="material-icons">edit</i></button></td>
                </tr>
                <tr data-subject="MAPEH" data-teachers='["Mr. Alexander King","Ms. Isabella Wright"]'>
                  <td>MAPEH</td>
                  <td class="teacher-cell"></td>
                  <td><button class="edit-icon-btn"><i class="material-icons">edit</i></button></td>
                </tr>
                <tr data-subject="Filipino" data-teachers='["Ms. Emma Scott"]'>
                  <td>Filipino</td>
                  <td class="teacher-cell"></td>
                  <td><button class="edit-icon-btn"><i class="material-icons">edit</i></button></td>
                </tr>
                <tr data-subject="Araling Panlipunan" data-teachers='["Mr. Benjamin Torres"]'>
                  <td>Araling Panlipunan</td>
                  <td class="teacher-cell"></td>
                  <td><button class="edit-icon-btn"><i class="material-icons">edit</i></button></td>
                </tr>
                <tr data-subject="Values Education" data-teachers='["Ms. Grace Rivera","Mr. Lucas Adams"]'>
                  <td>Values Education</td>
                  <td class="teacher-cell"></td>
                  <td><button class="edit-icon-btn"><i class="material-icons">edit</i></button></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- Edit Teachers Modal -->
    <div id="edit-teachers-modal" class="edit-modal-overlay" style="display:none;">
      <div class="edit-modal-content">
        <div class="edit-modal-header">
          <span id="edit-modal-title">Edit Subject Teachers</span>
          <button id="close-edit-modal" class="edit-modal-close">&times;</button>
        </div>
        <div class="edit-modal-body">
          <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Add New Teacher:</label>
            <div style="display: flex; gap: 0.5rem;">
              <select id="new-teacher-select" style="flex: 1; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; background: white;">
                <option value="">-- Select a teacher --</option>
              </select>
              <button id="add-teacher-btn" style="padding: 0.75rem 1.5rem; background: #4c7a67; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">Add</button>
            </div>
          </div>
          <div>
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Current Teachers:</label>
            <div class="edit-teacher-pills" style="min-height: 100px;"></div>
          </div>
        </div>
        <div class="edit-modal-footer">
          <button id="update-teachers-btn" class="update-changes-btn">Update Changes</button>
        </div>
      </div>
    </div>
    <!-- Edit Subjects Modal -->
    <div id="edit-subjects-modal" class="edit-modal-overlay" style="display:none;">
      <div class="edit-modal-content" style="max-width: 600px;">
        <div class="edit-modal-header">
          <span>Edit Subjects</span>
          <button id="close-edit-subjects-modal" class="edit-modal-close">&times;</button>
        </div>
        <div class="edit-modal-body">
          <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Add New Subject:</label>
            <div style="display: flex; gap: 0.5rem;">
              <input type="text" id="new-subject-input" placeholder="Enter subject name" style="flex: 1; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem;">
              <button id="add-subject-btn" style="padding: 0.75rem 1.5rem; background: #4c7a67; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">Add</button>
            </div>
          </div>
          <div>
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Current Subjects:</label>
            <div id="subjects-list-container" style="max-height: 400px; overflow-y: auto;"></div>
          </div>
        </div>
        <div class="edit-modal-footer">
          <button id="save-subjects-btn" class="update-changes-btn">Save Changes</button>
        </div>
      </div>
    </div>
    <a href="../admin-subject.html" class="back-fab-btn" title="Back" style="position:fixed;right:32px;bottom:32px;left:auto;z-index:99999;display:flex;align-items:center;justify-content:center;background:#4c7a67;width:56px;height:56px;border-radius:16px;">
        <svg width="32" height="32" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
    </a>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get initial subjects list
        let subjectsList = Array.from(document.querySelectorAll('.section-list li')).map(li => li.textContent.trim());
        
        // Render teacher pills in table
        function renderTablePills() {
            document.querySelectorAll('#subject-table tbody tr').forEach(row => {
                const teachers = JSON.parse(row.getAttribute('data-teachers'));
                const cell = row.querySelector('.teacher-cell');
                cell.innerHTML = teachers.map(t => `<button class=\"teacher-pill\">${t}</button>`).join(' ');
            });
        }
        renderTablePills();
        
        // Render subjects list in sidebar and table
        function renderSubjectsList() {
            const sidebarList = document.querySelector('.section-list');
            const tableBody = document.querySelector('#subject-table tbody');
            
            // Update sidebar list
            sidebarList.innerHTML = subjectsList.map(subject => `<li>${subject}</li>`).join('');
            
            // Update table - keep existing rows or create new ones
            const existingRows = Array.from(tableBody.querySelectorAll('tr'));
            const existingSubjects = existingRows.map(row => row.getAttribute('data-subject'));
            
            // Remove rows for subjects that no longer exist
            existingRows.forEach(row => {
                const subject = row.getAttribute('data-subject');
                if (!subjectsList.includes(subject)) {
                    row.remove();
                }
            });
            
            // Add new rows for subjects that don't exist in table
            subjectsList.forEach(subject => {
                if (!existingSubjects.includes(subject)) {
                    const newRow = document.createElement('tr');
                    newRow.setAttribute('data-subject', subject);
                    newRow.setAttribute('data-teachers', JSON.stringify([]));
                    newRow.innerHTML = `
                        <td>${subject}</td>
                        <td class="teacher-cell"></td>
                        <td><button class="edit-icon-btn"><i class="material-icons">edit</i></button></td>
                    `;
                    tableBody.appendChild(newRow);
                }
            });
            
            // Re-render teacher pills
            renderTablePills();
            
            // Re-attach edit button event listeners
            attachEditButtonListeners();
        }
        
        // Edit Subjects Modal functionality
        const editSubjectsBtn = document.querySelector('.edit-subjects-btn');
        const editSubjectsModal = document.getElementById('edit-subjects-modal');
        const closeEditSubjectsModal = document.getElementById('close-edit-subjects-modal');
        const newSubjectInput = document.getElementById('new-subject-input');
        const addSubjectBtn = document.getElementById('add-subject-btn');
        const subjectsListContainer = document.getElementById('subjects-list-container');
        const saveSubjectsBtn = document.getElementById('save-subjects-btn');
        
        function renderSubjectsInModal() {
            subjectsListContainer.innerHTML = subjectsList.map((subject, index) => `
                <div class="edit-subject-item" style="display: flex; align-items: center; justify-content: space-between; padding: 0.75rem; margin-bottom: 0.5rem; background: #f5f5f5; border-radius: 8px;">
                    <input type="text" value="${subject}" data-index="${index}" class="subject-edit-input" style="flex: 1; padding: 0.5rem; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 0.95rem; margin-right: 0.5rem;">
                    <button class="remove-subject-btn" data-index="${index}" style="padding: 0.5rem 1rem; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer;">Remove</button>
                </div>
            `).join('');
        }
        
        editSubjectsBtn.addEventListener('click', function() {
            renderSubjectsInModal();
            editSubjectsModal.style.display = 'flex';
            newSubjectInput.value = '';
        });
        
        closeEditSubjectsModal.onclick = function() {
            editSubjectsModal.style.display = 'none';
        };
        
        editSubjectsModal.onclick = function(e) {
            if (e.target === editSubjectsModal) {
                editSubjectsModal.style.display = 'none';
            }
        };
        
        addSubjectBtn.addEventListener('click', function() {
            const newSubject = newSubjectInput.value.trim();
            if (newSubject && !subjectsList.includes(newSubject)) {
                subjectsList.push(newSubject);
                renderSubjectsInModal();
                newSubjectInput.value = '';
            } else if (subjectsList.includes(newSubject)) {
                alert('This subject already exists!');
            }
        });
        
        newSubjectInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addSubjectBtn.click();
            }
        });
        
        subjectsListContainer.addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-subject-btn')) {
                const index = parseInt(e.target.getAttribute('data-index'));
                subjectsList.splice(index, 1);
                renderSubjectsInModal();
            }
        });
        
        subjectsListContainer.addEventListener('input', function(e) {
            if (e.target.classList.contains('subject-edit-input')) {
                const index = parseInt(e.target.getAttribute('data-index'));
                const newValue = e.target.value.trim();
                if (newValue) {
                    subjectsList[index] = newValue;
                }
            }
        });
        
        saveSubjectsBtn.addEventListener('click', function() {
            // Update subjects list (remove duplicates and empty values)
            subjectsList = subjectsList.filter((subject, index, self) => 
                subject.trim() && self.indexOf(subject) === index
            );
            
            renderSubjectsList();
            editSubjectsModal.style.display = 'none';
            
            // Show success message
            const successMsg = document.createElement('div');
            successMsg.textContent = 'Subjects updated successfully!';
            successMsg.style.cssText = 'position: fixed; top: 80px; right: 20px; background: #4c7a67; color: white; padding: 1rem 1.5rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 10000;';
            document.body.appendChild(successMsg);
            setTimeout(() => {
                successMsg.remove();
            }, 2000);
        });
        
        let editingRow = null;
        const modal = document.getElementById('edit-teachers-modal');
        const pillsContainer = modal.querySelector('.edit-teacher-pills');
        const closeModal = document.getElementById('close-edit-modal');
        const updateBtn = document.getElementById('update-teachers-btn');
        const modalTitle = document.getElementById('edit-modal-title');
        
        // Available teachers list (can be replaced with database data)
        const availableTeachers = [
            'Mr. Hermano Puli',
            'Mr. Max Verstappen',
            'Ms. Carla Sainz',
            'Ms. Alexandra Albon',
            'Ms. Ana Palito',
            'Mr. Kim Perez',
            'Ms. Baby Mandaguayon',
            'Mr. Pierre Gasly',
            'Ms. Karylle Samonte',
            'Ms. Yna Clarente',
            'Mr. Kyle Echavez',
            'Ms. Mary Marilag',
            'Mr. John Smith',
            'Ms. Jane Doe',
            'Mr. Michael Johnson',
            'Ms. Sarah Williams',
            'Mr. David Brown',
            'Ms. Emily Davis'
        ];
        
        // Function to populate teacher dropdown
        function populateTeacherDropdown() {
            const teacherSelect = document.getElementById('new-teacher-select');
            const currentTeachers = Array.from(pillsContainer.querySelectorAll('.edit-teacher-pill'))
                .map(div => div.childNodes[0].textContent.trim());
            
            // Clear existing options except the first one
            teacherSelect.innerHTML = '<option value="">-- Select a teacher --</option>';
            
            // Add available teachers that are not already assigned
            availableTeachers.forEach(teacher => {
                if (!currentTeachers.includes(teacher)) {
                    const option = document.createElement('option');
                    option.value = teacher;
                    option.textContent = teacher;
                    teacherSelect.appendChild(option);
                }
            });
        }
        
        function attachEditButtonListeners() {
            const editBtns = document.querySelectorAll('.edit-icon-btn');
            editBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    editingRow = this.closest('tr');
                    const subject = editingRow.getAttribute('data-subject');
                    const teachers = JSON.parse(editingRow.getAttribute('data-teachers'));
                    modalTitle.textContent = `Edit Teachers for ${subject}`;
                    pillsContainer.innerHTML = teachers.map(t => `<div class='edit-teacher-pill'>${t} <button class='remove-teacher-btn'>&#10060;</button></div>`).join('');
                    modal.style.display = 'flex';
                    // Populate dropdown when modal opens
                    populateTeacherDropdown();
                });
            });
        }
        
        // Attach edit button listeners
        attachEditButtonListeners();
        
        closeModal.onclick = function() {
            modal.style.display = 'none';
        };
        modal.onclick = function(e) {
            if (e.target === modal) modal.style.display = 'none';
        };
        updateBtn.onclick = function() {
            if (editingRow) {
                const newTeachers = Array.from(pillsContainer.querySelectorAll('.edit-teacher-pill')).map(div => div.childNodes[0].textContent.trim());
                editingRow.setAttribute('data-teachers', JSON.stringify(newTeachers));
                renderTablePills();
            }
            modal.style.display = 'none';
        };
        
        // Add teacher functionality
        const newTeacherSelect = document.getElementById('new-teacher-select');
        const addTeacherBtn = document.getElementById('add-teacher-btn');
        
        addTeacherBtn.addEventListener('click', function() {
            const selectedTeacher = newTeacherSelect.value;
            if (selectedTeacher) {
                const pillDiv = document.createElement('div');
                pillDiv.className = 'edit-teacher-pill';
                pillDiv.innerHTML = `${selectedTeacher} <button class='remove-teacher-btn'>&#10060;</button>`;
                pillsContainer.appendChild(pillDiv);
                newTeacherSelect.value = '';
                // Repopulate dropdown to remove the added teacher
                populateTeacherDropdown();
            }
        });
        
        // Update dropdown when a teacher is removed
        pillsContainer.addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-teacher-btn')) {
                e.target.parentElement.remove();
                // Repopulate dropdown to add back the removed teacher
                populateTeacherDropdown();
            }
        });
    });

    // Logout functionality with animation
    document.querySelector('.logout-btn').addEventListener('click', function(e) {
      const btn = e.currentTarget;
      const btnText = btn.querySelector('span');
      
      // Add loading animation
      btn.classList.add('btn-loading');
      btnText.textContent = 'Logging out...';
      
      // Simulate logout process
      setTimeout(() => {
        btn.classList.remove('btn-loading');
        btn.classList.add('btn-success', 'animate');
        btnText.textContent = 'Goodbye!';
        
        // Redirect after success animation
        setTimeout(() => {
          window.location.href = '../../index.html';
        }, 1000);
      }, 1500);
    });
    </script>
</body>
</html>

